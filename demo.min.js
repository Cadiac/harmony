C=Math.cos,S=Math.sin,P=Math.pow,run=()=>{let v=(a=new AudioContext).createGain();v.gain.value=.5;var c=a.createDelay(),r=(c.delayTime.value=.5,(delayFeedbackGainNode=a.createGain()).gain.value=.5,a.createGain());r.gain.value=.2,r.gain.linearRampToValueAtTime(.8,a.currentTime+2),r.gain.setValueAtTime(.8,a.currentTime+20),r.gain.linearRampToValueAtTime(0,a.currentTime+30);let l=a.createBiquadFilter(),f=(l.type="lowpass",a.createOscillator()),m=(f.frequency.value=6,f.start(),(lfoGainNode=a.createGain()).gain.value=5,f.connect(lfoGainNode),[[4,0,"sawtooth",1],[3,0,"triangle",.8]].map(([e,c,r])=>((o=new OscillatorNode(a)).type=r,o.frequency.value=440*P(2,e-4),o.detune.value=c,o.connect(v),lfoGainNode.connect(o.frequency),o.start(),[o,e])));return v.connect(l),v.connect(c),c.connect(delayFeedbackGainNode),delayFeedbackGainNode.connect(c),delayFeedbackGainNode.connect(l),l.connect(r),r.connect(a.destination),document.documentElement.requestFullscreen().then(()=>{e=performance.now(),t=0,frame=0,w=window.innerWidth,h=window.innerHeight,p=[3,2,1,0],canvas=document.createElement("canvas"),document.body.appendChild(canvas),canvas.width=w,canvas.height=h,(s=canvas.style).position="fixed",s.left=s.top=0,gl=canvas.getContext("webgl"),[program,effectsProgram]=[gl.createProgram(),gl.createProgram()],V="attribute vec2 p;void main(){gl_Position=vec4(p,0,1);}",shader=gl.createShader(35633),gl.shaderSource(shader,V),gl.compileShader(shader),gl.attachShader(program,shader),shader=gl.createShader(35632),gl.shaderSource(shader,"precision highp float;uniform float v;uniform vec2 d;uniform vec4 m;const vec3 i=vec3(.8,.7,.6),M=vec3(1,.92,1),e=vec3(.7,.8,.9);struct Material{vec3 d;vec3 m;vec3 e;float h;float f;};struct Surface{int i;float d;Material m;};struct Ray{Surface d;vec3 n;vec3 o;bool h;};float n(float v){return fract(v*17.*fract(v*.3183099));}float f(vec3 v){vec3 d=floor(v),M=fract(v),c=M*M*(3.-2.*M);float m=d.x+317.*d.y+157.*d.z,e=n(m),i=n(m+1.),o=n(m+317.),z=n(m+318.),f=n(m+157.),h=n(m+158.),y=n(m+474.),S=n(m+475.);return-1.+2.*(e+(i-e)*c.x+(o-e)*c.y+(f-e)*c.z+(e-i-o+z)*c.x*c.y+(e-o-f+y)*c.y*c.z+(e-i-f+h)*c.z*c.x+(-e+i+o-z+f-h-y+S)*c.x*c.y*c.z);}float t(vec3 v){float m=0.,M=.5;for(int i=0;i<7;i++){float c=f(v);m+=M*c;M*=.5;v=2.*mat3(0.,.8,.6,-.8,.36,-.48,-.6,-.48,.64)*v;}return m;}mat3 s(float v){float m=sin(v),M=cos(v);return mat3(vec3(1,0,0),vec3(0,M,-m),vec3(0,m,M));}mat3 l(float v){float m=sin(v),M=cos(v);return mat3(vec3(M,0,m),vec3(0,1,0),vec3(-m,0,M));}mat3 r(float v){float m=sin(v),M=cos(v);return mat3(vec3(M,-m,0),vec3(m,M,0),vec3(0,0,1));}float f(vec3 v,vec3 m,vec3 e){vec3 i=v-m,M=e-m;return length(i-M*clamp(dot(i,M)/dot(M,M),0.,1.))-.05;}float f(vec3 v,float m){return length(v)-m;}float h(vec3 v){vec3 m=abs(v)-vec3(2);return length(max(m,0.))+min(max(m.x,max(m.y,m.z)),0.);}float p(vec3 v){vec3 M=vec3(m.xy,0),e=vec3(m.zw,0);float i=f(v,.3),d=f(v-M,.8),h=f(v-e,.5),c=f(v,vec3(0),M),z=f(v,M,e);return min(min(i,min(d,h)),min(c,z));}Surface h(Surface m,Surface v){if (m.d<v.d){return m;}return v;}Surface c(vec3 m){Surface i,M=Surface(0,p(m-vec3(0,9,0)),Material(vec3(.5),vec3(.5),vec3(.5),50.,.5)),d=Surface(1,dot(m,vec3(0,1.5,0))+2.,Material(vec3(1),vec3(.5),vec3(.5),2.,0.)),e=Surface(2,f(m-vec3(5),5.),Material(vec3(.5),vec3(.5),vec3(.5),50.,.5)),z=Surface(3,f(m-vec3(-2,2,-3),3.),Material(vec3(1,.3,.2),vec3(.9,.5,.5),vec3(.9),50.,.3)),c=Surface(4,h(s(v*1e-4)*l(v*5e-4)*(m-vec3(-8,5,3))),Material(vec3(.5,.5,.8),vec3(.1),vec3(.9),50.,.5));i=h(d,M);i=h(i,e);i=h(i,z);return h(i,c);}vec3 c(vec3 m,vec3 v,vec3 d){vec3 f=e-.5*v.y,c=exp2(-abs((2.5e4-m.y)/v.y)*1e-5*M);f=f*c+(1.-c)*i;float h=dot(d,v);if(h>.9999)f=vec3(.9);return f;}float c(vec3 v,vec3 m){float i=1.,M=1.;for(int f=0;f<400;++f){if(M>=250.)return i;Surface d=c(m+M*v);if(d.d<1e-5)return 0.;i=min(i,10.*d.d/M);M+=d.d;}return i;}mat4 S(vec3 v){vec3 m=normalize(vec3(0,5,0)-v),M=normalize(cross(normalize(vec3(0,1,0)),m));return mat4(vec4(M,0),vec4(cross(m,M),0),vec4(-m,0),vec4(0,0,0,1));}vec3 S(vec3 v,vec3 m,vec3 d,vec3 e,float f,Material h){float l=c(v,d);vec3 z=exp2(-f*.05*M);return(h.m+h.d*clamp(dot(v,m)*l,0.,1.)+h.e*pow(clamp(dot(reflect(v,m),e),0.,1.),h.h))*z+(1.-z)*i;}Ray S(vec3 m,vec3 v){float i=1e-5,M=1e-5;Ray f;for(int d=0;d<400;d++){i=.001*M;f.o=m+M*v;f.d=c(f.o);if(f.d.d<i){f.h=true;break;}M+=f.d.d*.5;if(M>=250.)break;}f.d.d=M;return f;}vec3 l(vec3 m,vec3 f){vec3 M=normalize(vec3(0,10,v/5e2)),i=vec3(0);float d=1.;vec3 e=f;float z=0.;Ray h=S(m,e);for(int o=0;o<4;o++){if(!h.h){i=mix(i,c(m,e,M),d);break;}vec3 y=vec3(0);if(h.d.i==1)y=vec3(0,1,0);else if(h.d.i==2)y=normalize(h.o-.5*t(r(v*1e-4)*h.o*5.)-vec3(5));else if(h.d.i==3)y=normalize(h.o-vec3(-1,2,-3));else{const vec2 l=vec2(1,-1);y=normalize(l.xyy*c(h.o+l.xyy*1e-5).d+l.yyx*c(h.o+l.yyx*1e-5).d+l.yxy*c(h.o+l.yxy*1e-5).d+l.xxx*c(h.o+l.xxx*1e-5).d);}z+=h.d.d;vec3 l=S(M,y,h.o,e,z,h.d.m);i=mix(i,l,d);d*=h.d.m.f;if(d<1e-5)break;e=reflect(e,y);h=S(h.o,e);}if(!h.h||h.d.i==1){float l=clamp(dot(M,e),0.,1.);i+=.5*vec3(1,.5,.2)*pow(l,32.);}return i;}void main(){vec2 m=gl_FragCoord.xy-d/2.;vec3 i=vec3(-8.+20.*sin(v/1e4),4.+sin(v/5e3),-20.+20.*cos(v/1e4));mat4 f=S(i);vec3 h=l(i,(f*vec4(normalize(vec3(m,-d.y/tan(radians(60.)/2.))),0)).xyz);h=pow(h,M);h*=vec3(1.02,.99,.9);h.z=h.z+.1;h=smoothstep(0.,1.,h);gl_FragColor=vec4(h,1);}"),gl.compileShader(shader),gl.attachShader(program,shader),gl.linkProgram(program),shader=gl.createShader(35633),gl.shaderSource(shader,V),gl.compileShader(shader),gl.attachShader(effectsProgram,shader),shader=gl.createShader(35632),gl.shaderSource(shader,"precision highp float;uniform float f;uniform vec2 h;uniform sampler2D z,t;void main(){vec2 v=gl_FragCoord.xy/h;vec3 u=mix(texture2D(z,v).xyz,texture2D(t,v).xyz,.25);float m=f<3e4?0.:(f-3e4)/1e4;u*=.5+(.5+m)*pow(32.*v.x*v.y*(1.-v.x)*(1.-v.y),.5);u+=m*vec3(1);gl_FragColor=vec4(u,1);}"),gl.compileShader(shader),gl.attachShader(effectsProgram,shader),gl.linkProgram(effectsProgram),A=34962,B=3553,F=36160,gl.bindBuffer(A,gl.createBuffer()),gl.bufferData(A,new Float32Array([1,1,1,-1,-1,1,-1,-1]),35044),gl.enableVertexAttribArray(0),gl.vertexAttribPointer(0,2,5126,!1,0,0),textures=[1,2].map(()=>{var e=gl.createTexture(),a=(gl.bindTexture(B,e),gl.texParameteri(B,10240,9728),gl.texParameteri(B,10241,9728),gl.texParameteri(B,10242,33071),gl.texParameteri(B,10243,33071),gl.texImage2D(B,0,6408,w,h,0,6408,5121,null),gl.createFramebuffer());return gl.bindFramebuffer(F,a),gl.framebufferTexture2D(F,36064,B,e,0),[e,a]}),L=(c,e)=>{var[e,a,r,v]=e.map((e,a)=>p[a]+e*c);return A1=4/15,A2=.75,a1=A1*C(e-a),a2=A2*C(e-a),f1=-(A1*P(v,2)*S(e-a))-10*S(e)/3,f2=A2*P(r,2)*S(e-a)-2.5*S(a),g1=(2e4<now?-.5:0)*r+(f1-a1*f2)/(1-a1*a2),g2=(2e4<now?-.5:0)*r+(f2-a2*f1)/(1-a1*a2),[r,v,g1,g2]},window.requestAnimationFrame(function c(){if(now=performance.now()-e,dt=(now-t)/1e3,35e3<(t=now))return document.exitFullscreen();X=L(0,[0,0,0,0]),Y=L(dt/2,X),Z=L(dt/2,Y),W=L(dt,Z),p.map((e,a)=>{p[a]+=dt*(X[a]+2*Y[a]+2*Z[a]+W[a])/6}),x=3*S(p[0]),xx=x+4*S(p[1]),y=3*-C(p[0]),yy=y-4*C(p[1]),m[0][0].frequency.setValueAtTime(27.5*(3+y),a.currentTime),m[1][0].frequency.setValueAtTime((14+yy)/7*220,a.currentTime),l.frequency.setValueAtTime(.15*Math.abs(p[3])*a.sampleRate/2,a.currentTime),l.Q.setValueAtTime(10+10*S(p[1]),a.currentTime),f.frequency.setValueAtTime(Math.abs(p[3]),a.currentTime),gl.bindFramebuffer(F,textures[frame%2][1]),gl.viewport(0,0,w,h),gl.clearColor(0,0,0,1),gl.clear(16384),gl.useProgram(program),gl.uniform1f(gl.getUniformLocation(program,"v"),now),gl.uniform2f(gl.getUniformLocation(program,"d"),w,h),gl.uniform4f(gl.getUniformLocation(program,"m"),x,y,xx,yy),gl.drawArrays(5,0,4),gl.bindFramebuffer(F,null),gl.viewport(0,0,w,h),gl.clearColor(0,0,0,1),gl.clear(16384),gl.useProgram(effectsProgram),gl.uniform1f(gl.getUniformLocation(effectsProgram,"u_time"),now),gl.uniform2f(gl.getUniformLocation(effectsProgram,"u_resolution"),w,h),gl.uniform1i(gl.getUniformLocation(effectsProgram,"u_texture0"),0),gl.uniform1i(gl.getUniformLocation(effectsProgram,"u_texture1"),1),gl.uniform1f(gl.getUniformLocation(effectsProgram,"f"),now),gl.uniform2f(gl.getUniformLocation(effectsProgram,"h"),w,h),gl.uniform1i(gl.getUniformLocation(effectsProgram,"z"),0),gl.uniform1i(gl.getUniformLocation(effectsProgram,"t"),1),gl.activeTexture(33984),gl.bindTexture(B,textures[frame%2][0]),frame+=1,gl.activeTexture(33985),gl.bindTexture(B,textures[frame%2][0]),gl.drawArrays(5,0,4),window.requestAnimationFrame(c)})})};
